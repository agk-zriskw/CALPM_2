---
title: "CALPM"
author: "Grupa 2"
format: 
  html:
    toc: true
    toc-location: right
    toc-title: Spis Treści
    number-sections: true
    embed-resources: true
    html-math-method: katex
    code-tools: true
    code-fold: show
    code-summary: "Show and hide code"
    link-external-icon: true
    link-external-newwindow: true
    smooth-scroll: true
    self-contained: true
    fig-align: center
execute: 
  echo: true
  cache: true
  error: false
  warning: false
  output: true
---

# Pakiety

Pakiety potrzebne do wykonanie analizy danych i modeli.

```{r}
library(tidymodels)
library(tidyverse)
library(stringr)
library(vip)
library(pdp)
library(DALEX)
library(DALEXtra)
library(bestNormalize)
library(rules)
library(baguette)
library(finetune)
library(doParallel)
library(openair)
```


# Dane

Załadowanie danych treningowych.

```{r}
load("dane/ops.RData") 
```

## Opis danych znajdujących się w zbiorze

```{r}
ops |> glimpse()
```

Zestaw składa się z 21 zmiennych oraz 909 obserwacji. Objaśnienie każdej z nich:

* `date` - Data (krok 1 godzina)
* `grimm_pm10` - Średnie 1-godzinne stężenia PM10 zmierzone za pomocą GRIMM EDM 180
* `ops_pm10` - Średnie 1-godzinne stężenia PM10 zmierzone za pomocą TSI OPS 3330
* `n_0044` - liczba zliczeń cząstek w od 0.3 do 0.44 µm wyrażona w zliczeniach/cm^3^
* `n_0075` - liczba zliczeń cząstek w od 0.44 do 0.75 µm wyrażona w zliczeniach/cm^3^
* `n_0100` - liczba zliczeń cząstek w od 0.75 do 1.00 µm wyrażona w zliczeniach/cm^3^
* `n_0120` - liczba zliczeń cząstek w od 1.00 do 1.20 µm wyrażona w zliczeniach/cm^3^
* `n_0140` - liczba zliczeń cząstek w od 1.20 do 1.40 µm wyrażona w zliczeniach/cm^3^
* `n_0200` - liczba zliczeń cząstek w od 1.40 do 2.00 µm wyrażona w zliczeniach/cm^3^
* `n_0250` - liczba zliczeń cząstek w od 2.00 do 2.50 µm wyrażona w zliczeniach/cm^3^
* `n_0500` - liczba zliczeń cząstek w od 2.50 do 5.00 µm wyrażona w zliczeniach/cm^3^
* `n_0750` - liczba zliczeń cząstek w od 5.00 do 7.50 µm wyrażona w zliczeniach/cm^3^
* `n_1000` - liczba zliczeń cząstek w od 7.50 do 10.4 µm wyrażona w zliczeniach/cm^3^
* `temp` - temperatura powietrza [°C]
* `rh` - wilgotność względna [%]
* `pres` - ćiśnienie na poziomie stacji [hPa]
* `pres_sea` - ciśnienie nad poziomem morza [hPa]
* `wd` - kierunke wiatru [°]
* `mws` - maksymlan prędkość wiatru [m/s]
* `ws` - prędkość wiatru [m/s]
* `prec` - opad atmosferyczny [mm/h]

```{r}
ops |> is.na() |> colSums()
```

W zbiorze można zaobserwować liczne braki danych, które należy wyelminować przed dalszą analizą.

```{r}
ops <- ops |> na.omit()

ops |> is.na() |> sum()
```

Wszystkie braki danych zosatały usunięte.

```{r}
ops |> summary()
```

Powyżej przedstawiono podsumowanie wszystkich atrybutów zbioru danych.

## Zbiór weryfikacyjny i przygotowanie danych do analizy

Dane w zbiorze weryikacyjnym zawierają analogiczne informacje stosunku do zestawu danych `ops`, ale pomiary zostały wykonane w innym czasie i miejscu. Ponadto zastosowano inną metodę referencyjną pomiaru stężeń PM10 tj. BAM 1020 Met One Instruments zamiast GRIMM EDM 180.

Załadowanie danych weryfikacyjnych.

```{r}
load("dane/data_test.rdata")
```

Podgląd danych:

```{r}
ops_data |> glimpse()
```
Do analizy zosatną wykorzystane dane od data do prec, połaczone z danymi ramki danych bam.

```{r}
bam |> tail(5)
```
Dane będą połączone przy pomocy zamiennej `date` zapobiegając problemowi różnej ilości obserwacji.

Przygotowanie dany:

```{r}
weryfikacja <- ops_data |> select(date:prec)

weryfikacja <- weryfikacja |> 
  left_join(bam, by = "date") |> 
  mutate(grimm_pm10 = bam_pm10) |> 
  select(-bam_pm10)
ops <- ops |> select(-ops_pm10, -pres_sea)

nazwy <- colnames(ops) |> dput()
weryfikacja <- weryfikacja |> 
  select(all_of(nazwy))

colnames(weryfikacja) == colnames(ops)
```
Poniżej wszystkie aktrybuty danych weryfikacyjnych już z podmienioną kolumną `grimm_pm10` na dane pochodzące z czujnika BAM 1020.

Usunieto dodatkowo braki danych znajdujące się w zbiorze.

```{r}
weryfikacja <- weryfikacja |> na.omit()

weryfikacja |> glimpse()
```

